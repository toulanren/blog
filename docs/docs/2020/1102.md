# 玩转群晖：实现数据备份自动化的方案

## 概念

存储备份遵循 3-2-1 法则，指的是：

- 你的数据一定要有 3 个拷贝
- 保存在 2 种不同的介质上
- 其中至少要有 1 份存放在异地

不同的人对于 3-2-1 有自己的理解，在我的方案里，理解如下：

**3 个拷贝**

- 办公设备：各处的 PC
- NAS
- 移动硬盘

**2 种介质**

- 本地电脑
- 移动硬盘

**1 份异地**

- NAS

## 方案

对于我个人来说，有几个存储数据的地方。

- NAS：数据中心
- MacBook Pro：工作环境
- 百度云：云服务商备份
- U 盘：本地冷存储

所以最终的拓扑图是这样的：

![image](https://user-images.githubusercontent.com/45085199/124555458-b08e9a00-de69-11eb-94c4-4e4505a56b1c.png)

## 配置

这里只是简单写一些，细节还是自行网上搜索。

### NAS

1. 启用家目录：控制面板 - 用户账号 - 高级设置 - 家目录 - 启动家目录，这样就为每个用户创建了 home 目录
2. 安装 Synology Drive：套件中心安装，这样每个用户的 home 目录下就存在了 Drive 目录
3. 打开 Drive，创建一个目录，作为你的同步目录，比如“我的文件/pc”
4. 套件中心安装 Cloud Sync，设置同步任务，选择 Drive 下的目录，比如“我的文件/pc”，设置加密传输，保证数据安全性

这样，NAS 的设置就完成了

### 电脑

这一步就很简单，在电脑上装 Synology Drive 的客户端，选择同步目录，比如上面设置的“我的文件/pc”，这样实时更新就会同步到 nas 了。

### U 盘

1. 插上 U 盘，在：控制面板 - 外接设备，选择 U 盘进行下格式化。
2. 套件中心安装 USB Copy，设置备份任务，勾选“复制完成后退出 USB/SD 存储设备”，毕竟作为冷备份，备份完退出保证安全性

因为第二步勾选了“复制完成后退出 USB/SD 存储设备”，所以一次备份后，就无法再次备份，所以提供两个方案：

1. 不启用自动备份，勾选“插入 USB/SD 存储设备时，立即复制数据”，隔一段时间手动拔插一下设备。
2. 启用自动备份，并且给 nas 设置定时开关机，自动备份的时间设置在开机后的 1 个小时。

我是使用方案 2，自动开关机后，会重新挂载 USB/SD 存储设备，所以可以再次进行备份，实现完全自动。设置一个小时后，是保证 nas 平稳运行一段时间，避免 bug。
